<%= content_for :head do %>
 <script type="text/javascript">
  $(function(){
    $('#counter').jqEasyCounter({
		'maxChars': 180,
	    'maxCharsWarning': 165,
	    'msgFontSize': '15px',
	    'msgFontColor': '#005588',
	    'msgFontFamily': 'helvetica',
	    'msgTextAlign': 'right',
	    'msgWarningColor': 'red',
	    'msgAppendMethod': 'insertAfter'
      });
    $("#authenticate").click(function(){
      $.post('/microposts/create_pending', $("#new_micropost").serialize());
      return false;
    });
    $("#authenticate").fancybox({
      'transitionIn'    :    'elastic',
      'transitionOut'    :    'elastic',
      'speedIn'        :    400,
      'speedOut'        :    200,
      'overlayShow'    :    true
    });
  });
	</script>	
<% end %>
<table>
	<td class="name_container">
		<div class="profile_name"> 
			<%= @user.username %> 
		</div>
		<div class="profile_url">
		  truthpage.me/<%= @user.username %>
		</div>
		<div class="profile_avatar"> 
			<%= render_user_avatar(@user, :small) %>	
		</div>
		<div class="profile_truth_stats">
			<span class="profile_stat_counter"><%= @microposts.count %></span> truths posted<br/>
		</div>
		<div class="profile_truth_stats">
			<% unless @true_ratings.empty? %>
					<span class="profile_stat_counter"><%= number_to_percentage(@true_ratings.count.to_f / @total_ratings.count*100, :precision => 0) %></span> accuracy rate
				
			<% end %>
		</div>
		<div class="profile_blurb"> 
			<%= @user.blurb %> 
		</div>	
		<br/>
		<% if current_user %>
			<% if @user == current_user %>
			<% else %>
				<%= render_follow_links(@user) %>
					<br/>
				<%= render 'notifications/new_notification' %>
				<p/>
			<% end %>
		<% end %>

		<div class="profile_side">
			<div class="profile_following-h">
				Following · <%= @user.following.count %>
			</div>
			<div class="profile_following">
 				<% unless @following.empty? %>
    			<% @following.each do |user| %>
	  				<%= link_to render_follow_avatar(user, :tiny), user %>
	  				<%= link_to user.username, user, :class => 'followlist_name' %> 
	  				<br/>
    			<% end %>
  			<% end %>
			</div>

			<div class="profile_following-h">
				Followers · <%= @user.followers.count %>
			</div>
			<div class="profile_followers">
				<% unless @followers.empty? %>
    			<% @followers.each do |user| %>
	   				<%= link_to render_follow_avatar(user, :tiny), user %>
	   				<%= link_to user.username, user, :class => 'followlist_name' %> 
	   				<br/>
    			<% end %>
  			<% end %>
			</div>
		</div>
	</td>

	<td class="right_container">
		<div class="newpost_container">
			<% if @user == current_user %>
				<div class="profile_feed_header">
					Truths about <%= @user.username %>
				</div>
			<% else %>
				<div class="truth-is">
					truth is...
				</div>
				<%= render 'microposts/form' %>
			<% end %>
		</div>
		<table class="microposts" summary="User microposts">
			<% if @microposts.empty? %>
				<td class="profile_noshow">
					<%= @user.username %> doesn't have any truths yet.
				</td>
  		<% else %>
				<%= render @microposts  %>
			<% end %>
		</table>
			<%= will_paginate @microposts %>
	</td>
</table>
